<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Pybonacci">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>Cómo acelerar tu código Python con numba | Pybonacci</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" title="Pybonacci blog atom feed" href="/feeds/all.atom.xml" />
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/theme/css/fontello.css"/>
        <style>.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #60a0b0; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #007020; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #007020 } /* Comment.Preproc */
.highlight .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.highlight .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #007020 } /* Keyword.Pseudo */
.highlight .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #902000 } /* Keyword.Type */
.highlight .m { color: #40a070 } /* Literal.Number */
.highlight .s { color: #4070a0 } /* Literal.String */
.highlight .na { color: #4070a0 } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.highlight .no { color: #60add5 } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #007020 } /* Name.Exception */
.highlight .nf { color: #06287e } /* Name.Function */
.highlight .nl { color: #002070; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #062873; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #bb60d5 } /* Name.Variable */
.highlight .ow { color: #007020; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #40a070 } /* Literal.Number.Float */
.highlight .mh { color: #40a070 } /* Literal.Number.Hex */
.highlight .mi { color: #40a070 } /* Literal.Number.Integer */
.highlight .mo { color: #40a070 } /* Literal.Number.Oct */
.highlight .sb { color: #4070a0 } /* Literal.String.Backtick */
.highlight .sc { color: #4070a0 } /* Literal.String.Char */
.highlight .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #4070a0 } /* Literal.String.Double */
.highlight .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #4070a0 } /* Literal.String.Heredoc */
.highlight .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.highlight .sx { color: #c65d09 } /* Literal.String.Other */
.highlight .sr { color: #235388 } /* Literal.String.Regex */
.highlight .s1 { color: #4070a0 } /* Literal.String.Single */
.highlight .ss { color: #517918 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #bb60d5 } /* Name.Variable.Class */
.highlight .vg { color: #bb60d5 } /* Name.Variable.Global */
.highlight .vi { color: #bb60d5 } /* Name.Variable.Instance */
.highlight .il { color: #40a070 } /* Literal.Number.Integer.Long */</style>
        <style>.description-author {
  font-size: 0.8em;
  color: #333;
}
.img-author {
  max-height: 10em;
  max-width: 10em;
}
img[src$="centerme"] {
  display: block;
  margin: 0 auto;
}
body {
  margin: 0;
  padding: 0;
  font: 15px 'Source Sans Pro', sans-serif;
  line-height: 1.6em;
  color: #222222;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}
a {
  color: #007ee5;
  text-decoration: none;
}
a:hover {
  color: #007ee5;
  text-decoration: none;
}
header.main-header {
  background: none repeat scroll 0% 0% #205F29;
  margin-bottom: 0px;
}
header.main-header a {
  color: #fff;
}
header.main-header .container {
  max-width: 1000px;
}
header.main-header .container nav a:hover {
  background-color: #5C881C;
}
header.navbar-default {
  border-bottom: none;
  background-color: #EFEFEF;
}
article {
  margin: 0;
}
article header.about {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
article header {
  padding-bottom: 20px;
}
article header h1 {
  margin-bottom: 2px;
  font-weight: 700;
  color: #000;
}
article header time {
  color: #9E9E9E;
  float: right;
}
article header time.left {
  color: #9E9E9E;
  float: left;
}
article div.social-links ul {
  padding: 0px;
}
article div.social-links li {
  display: inline;
  font-size: 20px;
}
article div.social-links li a {
  color: #000;
  padding: 10px;
}
article div.social-links li a:hover {
  color: #666;
  text-decoration: none;
}
article p {
  font-size: 2em;
  margin-bottom: 20px;
  line-height: 1.6em;
  text-align: justify;
}
article p.note {
  background: #f5f5f5;
  border: 1px solid #ddd;
  padding: 0.533em 0.733em;
}
article p.update {
  background-color: #FEEFB3;
  border: 1px solid #e6e68a;
  padding: 0.533em 0.733em;
}
article p.alert {
  background-color: #ffe2e2;
  border: 1px solid #ffb2b2;
  padding: 0.533em 0.733em;
}
article ul,
article ol {
  margin-top: 0px;
  margin-bottom: 25px;
}
article li {
  font-size: 16px;
  line-height: 1.6em;
}
article a:hover {
  text-decoration: underline;
}
article blockquote {
  border-left: 2px solid #c7c7cc;
  color: #666;
  margin: 30px 0;
  padding: 0 0 0 25px;
}
article img {
  max-width: 100%;
}
article code {
  color: #333;
  background-color: #EEE;
  border-radius: 0;
  font-size: 1.1em;
}
article .meta {
  margin-top: 35px;
}
article .meta a:hover {
  text-decoration: none;
}
article .meta div {
  display: block;
}
article .meta address:before,
article .meta time:before,
article .meta a.tag:before {
  font-family: 'fontello';
  margin-right: 6px;
}
article .meta address.author {
  float: left;
}
article .meta address:before {
  content: '\e819';
}
article .meta time:before {
  content: '\f133';
}
article .meta div.tags {
  clear: both;
}
article .meta a.tag {
  margin: 0 10px 10px 0;
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article .meta a.tag:before {
  content: '\e821';
}
article .meta a.tag:hover {
  background: rgba(0, 0, 0, 0.15);
}
article .meta a.read_more,
article .meta a.comments_btn {
  font-size: 14px;
  font-weight: 800;
  padding: 10px 20px;
  color: #007aa3;
  background: #FFF;
  border: 1px solid #007aa3;
}
article .meta a.read_more:hover,
article .meta a.comments_btn:hover {
  color: #FFF;
  background: #007aa3;
}
article .meta:after {
  content: "";
  display: table;
  clear: both;
}
.index {
  max-width: 700px;
}
.index article header h2 {
  font-size: 36px;
  margin-bottom: 2px;
  font-weight: 700;
}
.index article header h2 a {
  color: #333;
}
.index article header h2 a:hover {
  color: #007ee5;
  text-decoration: none;
}
.index .separator {
  padding: 40px 0 0 0;
  margin: 0 0 40px 0;
  height: 10px;
  border-bottom: solid 1px #CCC;
}
.index .pagination {
  display: block;
  margin-bottom: 100px;
}
.index .pagination .left {
  text-align: right;
}
.index .pagination .right {
  text-align: left;
}
.index .pagination a {
  display: inline-block;
  border: 2px solid #5C881C;
  margin: 0 5px;
  padding: 8px 20px;
  font-weight: bold;
  color: #5C881C;
}
.index .pagination a:hover {
  color: #FFF;
  background: #5C881C;
}
.post {
  max-width: 80%;
}
.post h1 {
  font-size: 42px;
}
.post h2:before {
  content: "# ";
  font-weight: bold;
  color: #DDD;
}
.post h3:before {
  content: "## ";
  font-weight: bold;
  color: #DDD;
}
.post h4:before {
  content: "### ";
  font-weight: bold;
  color: #DDD;
}
.post p {
  font-size: 2em;
}
.post li {
  font-size: 2em;
}
.list {
  max-width: 700px;
}
.list ul.double-list {
  margin: 0 auto 60px;
  padding: 0;
  list-style-type: none;
}
.list ul.double-list li {
  padding: 5px 0;
}
.list ul.double-list li h2 {
  font-size: 2em;
  display: inline;
  font-weight: normal;
}
.list ul.double-list li span {
  font-family: sans-serif;
  text-transform: uppercase;
  text-align: right;
  float: right;
  padding-top: 3px;
  font-size: 12px;
  color: #999;
}
.full-width-content {
  padding-top: 10px;
  padding-left: 0px;
  padding-right: 0px;
  margin-left: -20px;
  margin-right: -20px;
}
.col-xs-1,
.col-sm-1,
.col-md-1,
.col-lg-1,
.col-xs-2,
.col-sm-2,
.col-md-2,
.col-lg-2,
.col-xs-3,
.col-sm-3,
.col-md-3,
.col-lg-3,
.col-xs-4,
.col-sm-4,
.col-md-4,
.col-lg-4,
.col-xs-5,
.col-sm-5,
.col-md-5,
.col-lg-5,
.col-xs-6,
.col-sm-6,
.col-md-6,
.col-lg-6,
.col-xs-7,
.col-sm-7,
.col-md-7,
.col-lg-7,
.col-xs-8,
.col-sm-8,
.col-md-8,
.col-lg-8,
.col-xs-9,
.col-sm-9,
.col-md-9,
.col-lg-9,
.col-xs-10,
.col-sm-10,
.col-md-10,
.col-lg-10,
.col-xs-11,
.col-sm-11,
.col-md-11,
.col-lg-11,
.col-xs-12,
.col-sm-12,
.col-md-12,
.col-lg-12 {
  padding-right: 0px;
  padding-left: 0px;
}
.disclaimer {
  text-align: center;
  background-color: #EFEFEF;
  border-bottom: none;
  margin-top: 6em;
}
pre {
  font-size: 1.2em;
}</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

       <script src="https://comments.pybonacci.org/assets/js/commento.js" data-div="#commento"></script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        });
        MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>


        </script>

    </head>

    <body>
        <header class="navbar navbar-default bs-docs-nav">
            <div class="container-fluid">
                <div class="navbar-header">
		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#theNavbar">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span> 
		  </button>
                  <a class="navbar-brand" href="/" title="Home" class="title">Pybonacci</a><!-- — Python y Ciencia-->
                </div>
                <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation" id="theNavbar">
		    <ul class="nav navbar-nav navbar-right">
                            <li><a href="/pages/acerca-de-pybonacci.html" title="About">Acerca de</a></li>
                            <li><a href="/archives.html" title="Archive">Archivos</a></li>
                            <li><a class="nodec icon-rss" href="/feeds/all.atom.xml" title="pybonacci.github.io RSS feed" rel="me"></a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div id="wrap">
<div class="container post">
    <article>
        <header>
            <h1>Cómo acelerar tu código Python con numba</h1>
            <div class="meta">
                <time datetime="article.date.isoformat()" pubdate>vie 13 marzo 2015</time>
                <address class="vcard author">Por
                    <a class="url fn" href="http://pybonacci.github.io/author/juan-luis-cano.html">Juan Luis Cano</a>
                </address>
            </div>
        </header>

        <div class="article_content">
            <div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="Introducci&#243;n">
        Introducci&#243;n<a class="anchor-link" href="#Introducci&#243;n">&#182;</a>
      </h2></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    En este artículo vamos a hacer un repaso exhaustivo de <span class="nt">&lt;strong&gt;</span>cómo acelerar sustancialmente tu código Python usando numba<span class="nt">&lt;/strong&gt;</span>. Ya hablamos sobre <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://pybonacci.org/2012/08/21/probando-numba-compilador-para-python-basado-en-llvm/&quot;</span><span class="nt">&gt;</span>la primera versión de numba<span class="nt">&lt;/a&gt;</span> en el blog, allá por 2012, pero ha habido importantes cambios desde entonces y la herramienta ha cambiado muchísimo. Recientemente Continuum publicó numba 0.17 con una <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://numba.pydata.org/numba-doc/0.17.0/index.html&quot;</span><span class="nt">&gt;</span>nueva documentación<span class="nt">&lt;/a&gt;</span> mucho más fácil de seguir, pero aun así no siempre queda claro cuál es el camino para hacer que funcione, como quedó patente con el <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://pybonacci.org/2015/03/09/c-elemental-querido-cython/&quot;</span><span class="nt">&gt;</span>artículo sobre Cython<span class="nt">&lt;/a&gt;</span> de Kiko. Por ello, en este artículo voy a aclarar qué puede y qué no puede hacer numba, cómo sacarle partido y voy a detallar un par de ejemplos exitosos que he producido en los últimos meses.
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="c">&lt;!--more--&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    Hablando de las nuevas versiones de numba, en su web podéis ver una <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://numba.pydata.org/numba-benchmark/&quot;</span><span class="nt">&gt;</span>evolución temporal del rendimiento<span class="nt">&lt;/a&gt;</span> de algunas tareas que utiliza <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://spacetelescope.github.io/asv/&quot;</span><span class="nt">&gt;</span>asv<span class="nt">&lt;/a&gt;</span> para la visualización.
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="Entendiendo-numba:-el-modo-nopython">
        Entendiendo numba: el modo <em>nopython</em><a class="anchor-link" href="-el-modo-nopython">&#182;</a>
      </h2></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    Como podemos leer en la documentación, <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://numba.pydata.org/numba-doc/0.17.0/user/jit.html#nopython&quot;</span><span class="nt">&gt;</span>numba tiene dos modos de funcionamiento básicos<span class="nt">&lt;/a&gt;</span>: el modo <span class="nt">&lt;em&gt;</span>object<span class="nt">&lt;/em&gt;</span> y el modo <span class="nt">&lt;em&gt;</span>nopython<span class="nt">&lt;/em&gt;</span>.
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      El modo <span class="nt">&lt;em&gt;</span>object<span class="nt">&lt;/em&gt;</span> genera código que gestiona todas las variables como objetos de Python y utiliza la API C de Python para operar con ellas. En general en este modo <span class="nt">&lt;strong&gt;</span>no habrá ganancias de rendimiento<span class="nt">&lt;/strong&gt;</span> (e incluso puede ir más lento), con lo cual mi recomendación personal es directamente no utilizarlo. Hay casos en los que numba puede detectar los bucles y optimizarlos individualmente (<span class="nt">&lt;em&gt;</span>loop-jitting<span class="nt">&lt;/em&gt;</span>), pero no le voy a prestar mucha atención a esto.
    <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      El modo <span class="nt">&lt;em&gt;</span>nopython<span class="nt">&lt;/em&gt;</span> <span class="nt">&lt;strong&gt;</span>genera código independiente de la API C de Python<span class="nt">&lt;/strong&gt;</span>. Esto tiene la desventaja de que no podemos usar todas las características del lenguaje, <span class="nt">&lt;strong&gt;</span>pero tiene un efecto significativo en el rendimiento<span class="nt">&lt;/strong&gt;</span>. Otra de las restricciones es que <span class="nt">&lt;strong&gt;</span>no se puede reservar memoria para objetos nuevos<span class="nt">&lt;/strong&gt;</span>.
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    Por defecto numba usa el modo <span class="nt">&lt;em&gt;</span>nopython<span class="nt">&lt;/em&gt;</span> siempre que puede, y si no pasa a modo <span class="nt">&lt;em&gt;</span>object<span class="nt">&lt;/em&gt;</span>. Nosotros vamos a <span class="nt">&lt;strong&gt;</span>forzar el modo nopython<span class="nt">&lt;/strong&gt;</span> (o «modo estricto» como me gusta llamarlo) porque es la única forma de aprovechar el potencial de numba.
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="&#193;mbito-de-aplicaci&#243;n">
        &#193;mbito de aplicaci&#243;n<a class="anchor-link" href="#&#193;mbito-de-aplicaci&#243;n">&#182;</a>
      </h2></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    El problema del modo <span class="nt">&lt;em&gt;</span>nopython<span class="nt">&lt;/em&gt;</span> es que los mensajes de error son totalmente inservibles en la mayoría de los casos, así que antes de lanzarnos a compilar funciones con numba conviene hacer un repaso de qué no podemos hacer para anticipar la mejor forma de programar nuestro código. Podéis consultar en la documentación <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://numba.pydata.org/numba-doc/0.17.0/reference/pysupported.html&quot;</span><span class="nt">&gt;</span>el subconjunto de Python soportado por numba<span class="nt">&lt;/a&gt;</span> en modo <span class="nt">&lt;em&gt;</span>nopython<span class="nt">&lt;/em&gt;</span>, y ya os aviso que, al menos de momento, no tenemos <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://github.com/numba/numba/issues/504&quot;</span><span class="nt">&gt;&lt;em&gt;</span>list comprehensions<span class="nt">&lt;/em&gt;&lt;/a&gt;</span>, <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://github.com/numba/numba/issues/984&quot;</span><span class="nt">&gt;</span>generadores<span class="nt">&lt;/a&gt;</span> ni algunas cosas más. Permitidme que resalte una frase sacada de la página principal de numba:
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;blockquote&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      &quot;<span class="nt">&lt;em&gt;</span>With a few annotations, <span class="nt">&lt;strong&gt;</span>array-oriented and math-heavy Python code<span class="nt">&lt;/strong&gt;</span> can be just-in-time compiled to native machine instructions, similar in performance to C, C++ and Fortran<span class="nt">&lt;/em&gt;</span>&quot;. [Énfasis mío]
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/blockquote&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    Siento decepcionar a la audiencia pero <span class="nt">&lt;em&gt;</span>numba no acelerará todo el código Python<span class="nt">&lt;/em&gt;</span> que le echemos: está enfocado a operaciones matemáticas con arrays. Aclarado este punto, vamos a ponernos manos a la obra con un ejemplo aplicado 🙂
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="Antes-de-empezar:-instalaci&#243;n">
        Antes de empezar: instalaci&#243;n<a class="anchor-link" href="-instalaci&#243;n">&#182;</a>
      </h2></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    Puedes instalar numba en Windows, OS X y Linux con <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://conda.io/&quot;</span><span class="nt">&gt;</span>conda<span class="nt">&lt;/a&gt;</span> usando este comando:<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> <span class="nt">&lt;code&gt;</span>conda install numba<span class="nt">&lt;/code&gt;&lt;br</span> <span class="nt">/&gt;</span> conda se ocupará de instalar una versión correcta de LLVM, así que no tendrás que compilarla tú mismo. <span class="nt">&lt;em&gt;</span>Y ya está<span class="nt">&lt;/em&gt;</span>.<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> Ahora viene una opinión personal pero que considero importante: si eres usuario de paquetes científicos y aún no estás utilizando conda (o Anaconda) para gestionarlos, <span class="nt">&lt;strong&gt;</span>estás en la edad de piedra<span class="nt">&lt;/strong&gt;</span>. Me declaro fanboy absoluto de Continuum Analytics por crear una herramienta de código abierto (<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://github.com/conda/conda&quot;</span><span class="nt">&gt;</span>conda está en GitHub<span class="nt">&lt;/a&gt;</span>) que soluciona <span class="nt">&lt;em&gt;</span>por fin y de una vez por todas<span class="nt">&lt;/em&gt;</span> los problemas y frustración que hemos tenido como comunidad <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://twitter.com/fperez_org/status/569896953875722240&quot;</span><span class="nt">&gt;</span>desde hace 15 años<span class="nt">&lt;/a&gt;</span> y que Guido y otros se negaron a atajar. Yo llevo en esto solo desde 2011 pero aún recuerdo lo que es intentar compilar SciPy en Windows. Hazte un favor e <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://conda.pydata.org/miniconda.html&quot;</span><span class="nt">&gt;</span>instala Miniconda<span class="nt">&lt;/a&gt;</span>.
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="Acelerando-una-funci&#243;n-con-numba">
        Acelerando una funci&#243;n con numba<a class="anchor-link" href="#Acelerando-una-funci&#243;n-con-numba">&#182;</a>
      </h2></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    Voy a tomar directamente el ejemplo que usó Kiko para su artículo sobre Cython y vamos a ver cómo podemos utilizar numba (y un poco de astucia) para acelerar esta función:
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;blockquote&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      &quot;Por ejemplo, imaginemos que tenemos que detectar valores mínimos locales dentro de una malla. Los valores mínimos deberán ser simplemente valores más bajos que los que haya en los 8 nodos de su entorno inmediato. En el siguiente gráfico, el nodo en verde será un nodo con un mínimo y en su entorno son todo valores superiores:
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/blockquote&gt;</span>

  <span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (2, 0)
      <span class="nt">&lt;/td&gt;</span>

      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (2, 1)
      <span class="nt">&lt;/td&gt;</span>

      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (2, 2)
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>

    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (1, 0)
      <span class="nt">&lt;/td&gt;</span>

      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:green&quot;</span><span class="nt">&gt;</span>
        (1. 1)
      <span class="nt">&lt;/td&gt;</span>

      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (1, 2)
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>

    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (0, 0)
      <span class="nt">&lt;/td&gt;</span>

      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (0, 1)
      <span class="nt">&lt;/td&gt;</span>

      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">&quot;background:red&quot;</span><span class="nt">&gt;</span>
        (0, 2)
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/table&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    ¡Vamos allá!
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">install_ext</span> http://raw.github.com/jrjohansson/version_information/master/version_information.py
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;Installed version_information.py. To use it, type:
</pre></div>


<p>%load_ext version_information
</pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">load_ext</span> version_information
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">version_information</span> numpy, numba, cython
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;table&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;th&gt;</span>
            Software
          <span class="nt">&lt;/th&gt;</span>

          <span class="nt">&lt;th&gt;</span>
            Version
          <span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            Python
          <span class="nt">&lt;/td&gt;</span>

          <span class="nt">&lt;td&gt;</span>
            3.4.3 64bit [GCC 4.4.7 20120313 (Red Hat 4.4.7-1)]
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            IPython
          <span class="nt">&lt;/td&gt;</span>

          <span class="nt">&lt;td&gt;</span>
            3.0.0
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            OS
          <span class="nt">&lt;/td&gt;</span>

          <span class="nt">&lt;td&gt;</span>
            Linux 3.18.6 1 ARCH x86_64 with arch
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            numpy
          <span class="nt">&lt;/td&gt;</span>

          <span class="nt">&lt;td&gt;</span>
            1.9.2
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            numba
          <span class="nt">&lt;/td&gt;</span>

          <span class="nt">&lt;td&gt;</span>
            0.17.0
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            cython
          <span class="nt">&lt;/td&gt;</span>

          <span class="nt">&lt;td&gt;</span>
            0.22
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">&#39;2&#39;</span><span class="nt">&gt;</span>
            Fri Mar 13 13:44:39 2015 CET
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Vamos a empezar por importar los paquetes necesarios e inicializar la semilla del generador de números aleatorios:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numba</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi"></span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      Creamos nuestro array de datos:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      Y voy a copiar descaradamente la función de Kiko:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="k">def</span> <span class="nf">busca_min</span><span class="p">(</span><span class="n">malla</span><span class="p">):</span>
    <span class="n">minimosx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">minimosy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi"></span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">minimosx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">minimosy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimosx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimosy</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">busca_min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;(array([   1,    1,    1, ..., 1998, 1998, 1998]),
</pre></div>


<p>array([   1,    3,   11, ..., 1968, 1977, 1985]))</pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h3 id="Paso-1:-analizar-el-c&#243;digo">
        Paso 1: analizar el c&#243;digo<a class="anchor-link" href="-analizar-el-c&#243;digo">&#182;</a>
      </h3></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    Lo primero que pensé cuando vi esta función es que no me gustaba nada hacer <span class="nt">&lt;code&gt;</span>append<span class="nt">&lt;/code&gt;</span> a esas dos listas tantas veces. Pero a continuación me pregunté si realmente tendrían tantos elementos... averigüémoslo:
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">busca_min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">mx</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span>
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;pre&gt;</span>0.11091025<span class="nt">&lt;/pre&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Tenemos que más de un 10 % de los elementos de la matriz cumplen la condición de ser «mínimos locales», así que no es nada despreciable. Esto en nuestro ejemplo hace <em>un total de más de 400 000 elementos</em>:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">mx</span><span class="o">.</span><span class="n">size</span>
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;pre&gt;</span>443641<span class="nt">&lt;/pre&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Ahora la idea de crear dos listas y añadir los elementos uno a uno me gusta todavía menos, así que voy a cambiar de enfoque. Lo que voy a hacer va a ser crear otro array, de la misma forma que nuestros datos, y almacenar un valor <code>True</code> en aquellos elementos que cumplan la condición de mínimo local. De esta forma cumplo también una de las reglas de oro de Software Carpentry: "<em>Always initialize from data</em>".</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="k">def</span> <span class="nf">busca_min_np</span><span class="p">(</span><span class="n">malla</span><span class="p">):</span>
    <span class="n">minimos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">malla</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi"></span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">minimos</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="k">True</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">minimos</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      Encima puedo aprovechar la estupenda función <code>nonzero</code> de NumPy. Compruebo que las salidas son iguales:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">busca_min</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi"></span><span class="p">],</span> <span class="n">busca_min_np</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi"></span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">busca_min</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">busca_min_np</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      Y evalúo los rendimientos:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">timeit</span> busca_min(data)
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;1 loops, best of 3: 4.75 s per loop
</pre></div>


<p></pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">timeit</span> busca_min_np(data)
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;1 loops, best of 3: 4.62 s per loop
</pre></div>


<p></pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Parece que los tiempos son más o menos parecidos, pero al menos ya no tengo dos objetos en memoria que van a crecer de manera aleatoria. Vamos a ver ahora cómo nos puede ayudar numba a acelerar este código.</p>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h3 id="Paso-2:-aplicando-numba.jit(nopython=True)">
        Paso 2: aplicando <code>numba.jit(nopython=True)</code><a class="anchor-link" href="-aplicando-numba.jit(nopython=True)">&#182;</a>
      </h3></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    Como hemos dicho antes, vamos a forzar que numba funcione en modo <span class="nt">&lt;em&gt;</span>nopython<span class="nt">&lt;/em&gt;</span> para garantizar que obtenemos una mejora en el rendimiento. Si intentamos compilar la función definida en primer lugar va a fallar, porque ya hemos dicho más arriba que una de las condiciones es que <span class="nt">&lt;em&gt;</span>no se puede asignar memoria a objetos nuevos<span class="nt">&lt;/em&gt;</span>:
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">busca_min_jit</span> <span class="o">=</span> <span class="n">numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="k">True</span><span class="p">)(</span><span class="n">busca_min</span><span class="p">)</span>
<span class="n">busca_min_jit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;
</pre></div>


<p><span class="ansired">---------------------------------------------------------------------------</span>
<span class="ansired">NotImplementedError</span>                       Traceback (most recent call last)
<span class="ansigreen">&lt;ipython-input-14-3ca127791a45&gt;</span> in <span class="ansicyan">&lt;module&gt;</span><span class="ansiblue">()</span>
<span class="ansigreen">      1</span> busca_min_jit <span class="ansiyellow">=</span> numba<span class="ansiyellow">.</span>jit<span class="ansiyellow">(</span>nopython<span class="ansiyellow">=</span><span class="ansigreen">True</span><span class="ansiyellow">)</span><span class="ansiyellow">(</span>busca_min<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">----&gt; 2</span><span class="ansiyellow"> </span>busca_min_jit<span class="ansiyellow">(</span>data<span class="ansiyellow">)</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/dispatcher.py</span> in <span class="ansicyan">_compile_for_args</span><span class="ansiblue">(self, <em>args, </em>*kws)</span>
<span class="ansigreen">    155</span>         <span class="ansigreen">assert</span> <span class="ansigreen">not</span> kws<span class="ansiyellow"></span>
<span class="ansigreen">    156</span>         sig <span class="ansiyellow">=</span> tuple<span class="ansiyellow">(</span><span class="ansiyellow">[</span>self<span class="ansiyellow">.</span>typeof_pyval<span class="ansiyellow">(</span>a<span class="ansiyellow">)</span> <span class="ansigreen">for</span> a <span class="ansigreen">in</span> args<span class="ansiyellow">]</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 157</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> self<span class="ansiyellow">.</span>compile<span class="ansiyellow">(</span>sig<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    158</span> <span class="ansiyellow"></span>
<span class="ansigreen">    159</span>     <span class="ansigreen">def</span> inspect_types<span class="ansiyellow">(</span>self<span class="ansiyellow">,</span> file<span class="ansiyellow">=</span><span class="ansigreen">None</span><span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/dispatcher.py</span> in <span class="ansicyan">compile</span><span class="ansiblue">(self, sig)</span>
<span class="ansigreen">    275</span>                                           self<span class="ansiyellow">.</span>py_func<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">    276</span>                                           args<span class="ansiyellow">=</span>args<span class="ansiyellow">,</span> return_type<span class="ansiyellow">=</span>return_type<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 277</span><span class="ansiyellow">                                           flags=flags, locals=self.locals)
</span><span class="ansigreen">    278</span> <span class="ansiyellow"></span>
<span class="ansigreen">    279</span>             <span class="ansired"># Check typing error if object mode is used</span><span class="ansiyellow"></span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">compile_extra</span><span class="ansiblue">(typingctx, targetctx, func, args, return_type, flags, locals, library)</span>
<span class="ansigreen">    545</span>     pipeline = Pipeline(typingctx, targetctx, library,
<span class="ansigreen">    546</span>                         args, return_type, flags, locals)
<span class="ansigreen">--&gt; 547</span><span class="ansiyellow">     </span><span class="ansigreen">return</span> pipeline<span class="ansiyellow">.</span>compile_extra<span class="ansiyellow">(</span>func<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    548</span> <span class="ansiyellow"></span>
<span class="ansigreen">    549</span> <span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">compile_extra</span><span class="ansiblue">(self, func)</span>
<span class="ansigreen">    291</span>                 <span class="ansigreen">raise</span> e<span class="ansiyellow"></span>
<span class="ansigreen">    292</span> <span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 293</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> self<span class="ansiyellow">.</span>compile_bytecode<span class="ansiyellow">(</span>bc<span class="ansiyellow">,</span> func_attr<span class="ansiyellow">=</span>self<span class="ansiyellow">.</span>func_attr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    294</span> <span class="ansiyellow"></span>
<span class="ansigreen">    295</span>     def compile_bytecode(self, bc, lifted=(),</p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">compile_bytecode</span><span class="ansiblue">(self, bc, lifted, func_attr)</span>
<span class="ansigreen">    299</span>         self<span class="ansiyellow">.</span>lifted <span class="ansiyellow">=</span> lifted<span class="ansiyellow"></span>
<span class="ansigreen">    300</span>         self<span class="ansiyellow">.</span>func_attr <span class="ansiyellow">=</span> func_attr<span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 301</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> self<span class="ansiyellow">.</span>_compile_bytecode<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    302</span> <span class="ansiyellow"></span>
<span class="ansigreen">    303</span>     <span class="ansigreen">def</span> compile_internal<span class="ansiyellow">(</span>self<span class="ansiyellow">,</span> bc<span class="ansiyellow">,</span> func_attr<span class="ansiyellow">=</span>DEFAULT_FUNCTION_ATTRIBUTES<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">_compile_bytecode</span><span class="ansiblue">(self)</span>
<span class="ansigreen">    532</span> <span class="ansiyellow"></span>
<span class="ansigreen">    533</span>         pm<span class="ansiyellow">.</span>finalize<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 534</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> pm<span class="ansiyellow">.</span>run<span class="ansiyellow">(</span>self<span class="ansiyellow">.</span>status<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    535</span> <span class="ansiyellow"></span>
<span class="ansigreen">    536</span> <span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">run</span><span class="ansiblue">(self, status)</span>
<span class="ansigreen">    189</span>                     <span class="ansired"># No more fallback pipelines?</span><span class="ansiyellow"></span><span class="ansiyellow"></span>
<span class="ansigreen">    190</span>                     <span class="ansigreen">if</span> is_final_pipeline<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 191</span><span class="ansiyellow">                         </span><span class="ansigreen">raise</span> patched_exception<span class="ansiyellow"></span>
<span class="ansigreen">    192</span>                     <span class="ansired"># Go to next fallback pipeline</span><span class="ansiyellow"></span><span class="ansiyellow"></span>
<span class="ansigreen">    193</span>                     <span class="ansigreen">else</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">run</span><span class="ansiblue">(self, status)</span>
<span class="ansigreen">    181</span>             <span class="ansigreen">for</span> stage<span class="ansiyellow">,</span> stage_name <span class="ansigreen">in</span> self<span class="ansiyellow">.</span>pipeline_stages<span class="ansiyellow">[</span>pipeline_name<span class="ansiyellow">]</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    182</span>                 <span class="ansigreen">try</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 183</span><span class="ansiyellow">                     </span>res <span class="ansiyellow">=</span> stage<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    184</span>                 <span class="ansigreen">except</span> _EarlyPipelineCompletion <span class="ansigreen">as</span> e<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    185</span>                     <span class="ansigreen">return</span> e<span class="ansiyellow">.</span>result<span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">stage_nopython_frontend</span><span class="ansiblue">(self)</span>
<span class="ansigreen">    387</span>                 self<span class="ansiyellow">.</span>args<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">    388</span>                 self<span class="ansiyellow">.</span>return_type<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 389</span><span class="ansiyellow">                 self.locals)
</span><span class="ansigreen">    390</span> <span class="ansiyellow"></span>
<span class="ansigreen">    391</span>         with self.fallback_context(';Function "%s" has invalid return type';</p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">type_inference_stage</span><span class="ansiblue">(typingctx, interp, args, return_type, locals)</span>
<span class="ansigreen">    662</span>         infer<span class="ansiyellow">.</span>seed_type<span class="ansiyellow">(</span>k<span class="ansiyellow">,</span> v<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    663</span> <span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 664</span><span class="ansiyellow">     </span>infer<span class="ansiyellow">.</span>build_constrain<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    665</span>     infer<span class="ansiyellow">.</span>propagate<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    666</span>     typemap<span class="ansiyellow">,</span> restype<span class="ansiyellow">,</span> calltypes <span class="ansiyellow">=</span> infer<span class="ansiyellow">.</span>unify<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan">build_constrain</span><span class="ansiblue">(self)</span>
<span class="ansigreen">    375</span>         <span class="ansigreen">for</span> blk <span class="ansigreen">in</span> utils<span class="ansiyellow">.</span>itervalues<span class="ansiyellow">(</span>self<span class="ansiyellow">.</span>blocks<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    376</span>             <span class="ansigreen">for</span> inst <span class="ansigreen">in</span> blk<span class="ansiyellow">.</span>body<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 377</span><span class="ansiyellow">                 </span>self<span class="ansiyellow">.</span>constrain_statement<span class="ansiyellow">(</span>inst<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    378</span> <span class="ansiyellow"></span>
<span class="ansigreen">    379</span>     <span class="ansigreen">def</span> propagate<span class="ansiyellow">(</span>self<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan">constrain_statement</span><span class="ansiblue">(self, inst)</span>
<span class="ansigreen">    480</span>     <span class="ansigreen">def</span> constrain_statement<span class="ansiyellow">(</span>self<span class="ansiyellow">,</span> inst<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    481</span>         <span class="ansigreen">if</span> isinstance<span class="ansiyellow">(</span>inst<span class="ansiyellow">,</span> ir<span class="ansiyellow">.</span>Assign<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 482</span><span class="ansiyellow">             </span>self<span class="ansiyellow">.</span>typeof_assign<span class="ansiyellow">(</span>inst<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    483</span>         <span class="ansigreen">elif</span> isinstance<span class="ansiyellow">(</span>inst<span class="ansiyellow">,</span> ir<span class="ansiyellow">.</span>SetItem<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    484</span>             self<span class="ansiyellow">.</span>typeof_setitem<span class="ansiyellow">(</span>inst<span class="ansiyellow">)</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan">typeof_assign</span><span class="ansiblue">(self, inst)</span>
<span class="ansigreen">    514</span>             self<span class="ansiyellow">.</span>typeof_global<span class="ansiyellow">(</span>inst<span class="ansiyellow">,</span> inst<span class="ansiyellow">.</span>target<span class="ansiyellow">,</span> value<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    515</span>         <span class="ansigreen">elif</span> isinstance<span class="ansiyellow">(</span>value<span class="ansiyellow">,</span> ir<span class="ansiyellow">.</span>Expr<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 516</span><span class="ansiyellow">             </span>self<span class="ansiyellow">.</span>typeof_expr<span class="ansiyellow">(</span>inst<span class="ansiyellow">,</span> inst<span class="ansiyellow">.</span>target<span class="ansiyellow">,</span> value<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    517</span>         <span class="ansigreen">else</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    518</span>             <span class="ansigreen">raise</span> NotImplementedError<span class="ansiyellow">(</span>type<span class="ansiyellow">(</span>value<span class="ansiyellow">)</span><span class="ansiyellow">,</span> value<span class="ansiyellow">)</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan">typeof_expr</span><span class="ansiblue">(self, inst, target, expr)</span>
<span class="ansigreen">    618</span>                                              loc=inst.loc))
<span class="ansigreen">    619</span>         <span class="ansigreen">else</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 620</span><span class="ansiyellow">             </span><span class="ansigreen">raise</span> NotImplementedError<span class="ansiyellow">(</span>type<span class="ansiyellow">(</span>expr<span class="ansiyellow">)</span><span class="ansiyellow">,</span> expr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    621</span> <span class="ansiyellow"></span>
<span class="ansigreen">    622</span>     <span class="ansigreen">def</span> typeof_call<span class="ansiyellow">(</span>self<span class="ansiyellow">,</span> inst<span class="ansiyellow">,</span> target<span class="ansiyellow">,</span> call<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansired">NotImplementedError</span>: Failed at nopython (nopython frontend)
(&lt;class ';numba.ir.Expr';&gt;, build_list(items=[]))</pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      En este caso la traza es inservible y especificar los tipos de entrada no va a ayudar. Solo para verificar, vamos a ver qué pasa con el rendimiento si no forzamos el modo estricto:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">busca_min_jit_object</span> <span class="o">=</span> <span class="n">numba</span><span class="o">.</span><span class="n">jit</span><span class="p">()(</span><span class="n">busca_min</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">timeit</span> busca_min_jit_object(data)
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;1 loops, best of 3: 4.32 s per loop
</pre></div>


<p></pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Pocas ganancias respecto a la función sin compilar. ¿Qué pasa si intentamos lo mismo con la segunda función?</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">busca_min_np_jit</span> <span class="o">=</span> <span class="n">numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="k">True</span><span class="p">)(</span><span class="n">busca_min_np</span><span class="p">)</span>
<span class="n">busca_min_np_jit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;
</pre></div>


<p><span class="ansired">---------------------------------------------------------------------------</span>
<span class="ansired">UntypedAttributeError</span>                     Traceback (most recent call last)
<span class="ansigreen">&lt;ipython-input-17-bb9282bb2bfc&gt;</span> in <span class="ansicyan">&lt;module&gt;</span><span class="ansiblue">()</span>
<span class="ansigreen">      1</span> busca_min_np_jit <span class="ansiyellow">=</span> numba<span class="ansiyellow">.</span>jit<span class="ansiyellow">(</span>nopython<span class="ansiyellow">=</span><span class="ansigreen">True</span><span class="ansiyellow">)</span><span class="ansiyellow">(</span>busca_min_np<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">----&gt; 2</span><span class="ansiyellow"> </span>busca_min_np_jit<span class="ansiyellow">(</span>data<span class="ansiyellow">)</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/dispatcher.py</span> in <span class="ansicyan">_compile_for_args</span><span class="ansiblue">(self, <em>args, </em>*kws)</span>
<span class="ansigreen">    155</span>         <span class="ansigreen">assert</span> <span class="ansigreen">not</span> kws<span class="ansiyellow"></span>
<span class="ansigreen">    156</span>         sig <span class="ansiyellow">=</span> tuple<span class="ansiyellow">(</span><span class="ansiyellow">[</span>self<span class="ansiyellow">.</span>typeof_pyval<span class="ansiyellow">(</span>a<span class="ansiyellow">)</span> <span class="ansigreen">for</span> a <span class="ansigreen">in</span> args<span class="ansiyellow">]</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 157</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> self<span class="ansiyellow">.</span>compile<span class="ansiyellow">(</span>sig<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    158</span> <span class="ansiyellow"></span>
<span class="ansigreen">    159</span>     <span class="ansigreen">def</span> inspect_types<span class="ansiyellow">(</span>self<span class="ansiyellow">,</span> file<span class="ansiyellow">=</span><span class="ansigreen">None</span><span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/dispatcher.py</span> in <span class="ansicyan">compile</span><span class="ansiblue">(self, sig)</span>
<span class="ansigreen">    275</span>                                           self<span class="ansiyellow">.</span>py_func<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">    276</span>                                           args<span class="ansiyellow">=</span>args<span class="ansiyellow">,</span> return_type<span class="ansiyellow">=</span>return_type<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 277</span><span class="ansiyellow">                                           flags=flags, locals=self.locals)
</span><span class="ansigreen">    278</span> <span class="ansiyellow"></span>
<span class="ansigreen">    279</span>             <span class="ansired"># Check typing error if object mode is used</span><span class="ansiyellow"></span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">compile_extra</span><span class="ansiblue">(typingctx, targetctx, func, args, return_type, flags, locals, library)</span>
<span class="ansigreen">    545</span>     pipeline = Pipeline(typingctx, targetctx, library,
<span class="ansigreen">    546</span>                         args, return_type, flags, locals)
<span class="ansigreen">--&gt; 547</span><span class="ansiyellow">     </span><span class="ansigreen">return</span> pipeline<span class="ansiyellow">.</span>compile_extra<span class="ansiyellow">(</span>func<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    548</span> <span class="ansiyellow"></span>
<span class="ansigreen">    549</span> <span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">compile_extra</span><span class="ansiblue">(self, func)</span>
<span class="ansigreen">    291</span>                 <span class="ansigreen">raise</span> e<span class="ansiyellow"></span>
<span class="ansigreen">    292</span> <span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 293</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> self<span class="ansiyellow">.</span>compile_bytecode<span class="ansiyellow">(</span>bc<span class="ansiyellow">,</span> func_attr<span class="ansiyellow">=</span>self<span class="ansiyellow">.</span>func_attr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    294</span> <span class="ansiyellow"></span>
<span class="ansigreen">    295</span>     def compile_bytecode(self, bc, lifted=(),</p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">compile_bytecode</span><span class="ansiblue">(self, bc, lifted, func_attr)</span>
<span class="ansigreen">    299</span>         self<span class="ansiyellow">.</span>lifted <span class="ansiyellow">=</span> lifted<span class="ansiyellow"></span>
<span class="ansigreen">    300</span>         self<span class="ansiyellow">.</span>func_attr <span class="ansiyellow">=</span> func_attr<span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 301</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> self<span class="ansiyellow">.</span>_compile_bytecode<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    302</span> <span class="ansiyellow"></span>
<span class="ansigreen">    303</span>     <span class="ansigreen">def</span> compile_internal<span class="ansiyellow">(</span>self<span class="ansiyellow">,</span> bc<span class="ansiyellow">,</span> func_attr<span class="ansiyellow">=</span>DEFAULT_FUNCTION_ATTRIBUTES<span class="ansiyellow">)</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">_compile_bytecode</span><span class="ansiblue">(self)</span>
<span class="ansigreen">    532</span> <span class="ansiyellow"></span>
<span class="ansigreen">    533</span>         pm<span class="ansiyellow">.</span>finalize<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 534</span><span class="ansiyellow">         </span><span class="ansigreen">return</span> pm<span class="ansiyellow">.</span>run<span class="ansiyellow">(</span>self<span class="ansiyellow">.</span>status<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    535</span> <span class="ansiyellow"></span>
<span class="ansigreen">    536</span> <span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">run</span><span class="ansiblue">(self, status)</span>
<span class="ansigreen">    189</span>                     <span class="ansired"># No more fallback pipelines?</span><span class="ansiyellow"></span><span class="ansiyellow"></span>
<span class="ansigreen">    190</span>                     <span class="ansigreen">if</span> is_final_pipeline<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 191</span><span class="ansiyellow">                         </span><span class="ansigreen">raise</span> patched_exception<span class="ansiyellow"></span>
<span class="ansigreen">    192</span>                     <span class="ansired"># Go to next fallback pipeline</span><span class="ansiyellow"></span><span class="ansiyellow"></span>
<span class="ansigreen">    193</span>                     <span class="ansigreen">else</span><span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">run</span><span class="ansiblue">(self, status)</span>
<span class="ansigreen">    181</span>             <span class="ansigreen">for</span> stage<span class="ansiyellow">,</span> stage_name <span class="ansigreen">in</span> self<span class="ansiyellow">.</span>pipeline_stages<span class="ansiyellow">[</span>pipeline_name<span class="ansiyellow">]</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    182</span>                 <span class="ansigreen">try</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 183</span><span class="ansiyellow">                     </span>res <span class="ansiyellow">=</span> stage<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    184</span>                 <span class="ansigreen">except</span> _EarlyPipelineCompletion <span class="ansigreen">as</span> e<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    185</span>                     <span class="ansigreen">return</span> e<span class="ansiyellow">.</span>result<span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">stage_nopython_frontend</span><span class="ansiblue">(self)</span>
<span class="ansigreen">    387</span>                 self<span class="ansiyellow">.</span>args<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">    388</span>                 self<span class="ansiyellow">.</span>return_type<span class="ansiyellow">,</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 389</span><span class="ansiyellow">                 self.locals)
</span><span class="ansigreen">    390</span> <span class="ansiyellow"></span>
<span class="ansigreen">    391</span>         with self.fallback_context(';Function "%s" has invalid return type';</p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/compiler.py</span> in <span class="ansicyan">type_inference_stage</span><span class="ansiblue">(typingctx, interp, args, return_type, locals)</span>
<span class="ansigreen">    663</span> <span class="ansiyellow"></span>
<span class="ansigreen">    664</span>     infer<span class="ansiyellow">.</span>build_constrain<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 665</span><span class="ansiyellow">     </span>infer<span class="ansiyellow">.</span>propagate<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    666</span>     typemap<span class="ansiyellow">,</span> restype<span class="ansiyellow">,</span> calltypes <span class="ansiyellow">=</span> infer<span class="ansiyellow">.</span>unify<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    667</span> <span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan">propagate</span><span class="ansiblue">(self)</span>
<span class="ansigreen">    388</span>                 print<span class="ansiyellow">(</span><span class="ansiblue">"propagate"</span><span class="ansiyellow">.</span>center<span class="ansiyellow">(</span><span class="ansicyan">80</span><span class="ansiyellow">,</span> <span class="ansiblue">';-';</span><span class="ansiyellow">)</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    389</span>             oldtoken <span class="ansiyellow">=</span> newtoken<span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 390</span><span class="ansiyellow">             </span>self<span class="ansiyellow">.</span>constrains<span class="ansiyellow">.</span>propagate<span class="ansiyellow">(</span>self<span class="ansiyellow">.</span>context<span class="ansiyellow">,</span> self<span class="ansiyellow">.</span>typevars<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    391</span>             newtoken <span class="ansiyellow">=</span> self<span class="ansiyellow">.</span>get_state_token<span class="ansiyellow">(</span><span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    392</span>             <span class="ansigreen">if</span> config<span class="ansiyellow">.</span>DEBUG<span class="ansiyellow">:</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan">propagate</span><span class="ansiblue">(self, context, typevars)</span>
<span class="ansigreen">    110</span>         <span class="ansigreen">for</span> constrain <span class="ansigreen">in</span> self<span class="ansiyellow">.</span>constrains<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    111</span>             <span class="ansigreen">try</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 112</span><span class="ansiyellow">                 </span>constrain<span class="ansiyellow">(</span>context<span class="ansiyellow">,</span> typevars<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    113</span>             <span class="ansigreen">except</span> TypingError<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    114</span>                 <span class="ansigreen">raise</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typeinfer.py</span> in <span class="ansicyan"><strong>call</strong></span><span class="ansiblue">(self, context, typevars)</span>
<span class="ansigreen">    267</span>         <span class="ansigreen">for</span> ty <span class="ansigreen">in</span> valtys<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    268</span>             <span class="ansigreen">try</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 269</span><span class="ansiyellow">                 </span>attrty <span class="ansiyellow">=</span> context<span class="ansiyellow">.</span>resolve_getattr<span class="ansiyellow">(</span>value<span class="ansiyellow">=</span>ty<span class="ansiyellow">,</span> attr<span class="ansiyellow">=</span>self<span class="ansiyellow">.</span>attr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    270</span>             <span class="ansigreen">except</span> KeyError<span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">    271</span>                 args <span class="ansiyellow">=</span> <span class="ansiyellow">(</span>self<span class="ansiyellow">.</span>attr<span class="ansiyellow">,</span> ty<span class="ansiyellow">,</span> self<span class="ansiyellow">.</span>value<span class="ansiyellow">.</span>name<span class="ansiyellow">,</span> self<span class="ansiyellow">.</span>inst<span class="ansiyellow">)</span><span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typing/context.py</span> in <span class="ansicyan">resolve_getattr</span><span class="ansiblue">(self, value, attr)</span>
<span class="ansigreen">     82</span>                 <span class="ansigreen">raise</span><span class="ansiyellow"></span>
<span class="ansigreen">     83</span> <span class="ansiyellow"></span>
<span class="ansigreen">---&gt; 84</span><span class="ansiyellow">         </span>ret <span class="ansiyellow">=</span> attrinfo<span class="ansiyellow">.</span>resolve<span class="ansiyellow">(</span>value<span class="ansiyellow">,</span> attr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">     85</span>         <span class="ansigreen">assert</span> ret<span class="ansiyellow"></span>
<span class="ansigreen">     86</span>         <span class="ansigreen">return</span> ret<span class="ansiyellow"></span></p>
<p><span class="ansigreen">/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numba/typing/templates.py</span> in <span class="ansicyan">resolve</span><span class="ansiblue">(self, value, attr)</span>
<span class="ansigreen">    241</span>         ret <span class="ansiyellow">=</span> self<span class="ansiyellow">.</span>_resolve<span class="ansiyellow">(</span>value<span class="ansiyellow">,</span> attr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    242</span>         <span class="ansigreen">if</span> ret <span class="ansigreen">is</span> <span class="ansigreen">None</span><span class="ansiyellow">:</span><span class="ansiyellow"></span>
<span class="ansigreen">--&gt; 243</span><span class="ansiyellow">             </span><span class="ansigreen">raise</span> UntypedAttributeError<span class="ansiyellow">(</span>value<span class="ansiyellow">=</span>value<span class="ansiyellow">,</span> attr<span class="ansiyellow">=</span>attr<span class="ansiyellow">)</span><span class="ansiyellow"></span>
<span class="ansigreen">    244</span>         <span class="ansigreen">return</span> ret<span class="ansiyellow"></span>
<span class="ansigreen">    245</span> <span class="ansiyellow"></span></p>
<p><span class="ansired">UntypedAttributeError</span>: Failed at nopython (nopython frontend)
Unknown attribute "zeros_like" of type Module(&lt;module ';numpy'; from ';/home/juanlu/.miniconda3/envs/py34/lib/python3.4/site-packages/numpy/<strong>init</strong>.py';&gt;)</pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Me dice que no conoce la función <code>zeros_like</code>. Si acudimos a la documentación, podemos ver las <a href="http://numba.pydata.org/numba-doc/0.17.0/reference/numpysupported.html">características de NumPy soportadas por numba</a> y las funciones de creación de arrays <em>no</em> figuran entre ellas. Esto es consistente con lo que hemos dicho más arriba: no vamos a poder asignar memoria a objetos nuevos.</p>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h3 id="Paso-3:-Reestructurar-el-c&#243;digo">
        Paso 3: Reestructurar el c&#243;digo<a class="anchor-link" href="-Reestructurar-el-c&#243;digo">&#182;</a>
      </h3></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    ¿Estamos en un callejón sin salida entonces? ¡En absoluto! Lo que vamos a hacer va a ser separar la parte intensiva de la función para aplicar <span class="nt">&lt;code&gt;</span>numba.jit<span class="nt">&lt;/code&gt;</span> sobre ella, e inicializar todos los valores desde fuera. Para los que hayan usado subrutinas en Fortran este enfoque les resultará familiar 🙂
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="k">def</span> <span class="nf">busca_min_np_jit</span><span class="p">(</span><span class="n">malla</span><span class="p">):</span>
    <span class="n">minimos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">malla</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">_busca_min</span><span class="p">(</span><span class="n">malla</span><span class="p">,</span> <span class="n">minimos</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">minimos</span><span class="p">)</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_busca_min</span><span class="p">(</span><span class="n">malla</span><span class="p">,</span> <span class="n">minimos</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi"></span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">minimos</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="k">True</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      Veamos qué ocurre ahora:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">busca_min_np_jit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;(array([   1,    1,    1, ..., 1998, 1998, 1998]),
</pre></div>


<p>array([   1,    3,   11, ..., 1968, 1977, 1985]))</pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">busca_min</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi"></span><span class="p">],</span> <span class="n">busca_min_np_jit</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi"></span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">busca_min</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">busca_min_np_jit</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">timeit</span> busca_min_np_jit(data)
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;10 loops, best of 3: 62.9 ms per loop
</pre></div>


<p></pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Habéis leído bien: <strong>70x más rápido</strong> 🙂<br /> ¡Lo hemos conseguido! Ahora nuestro código funciona en numba sin problemas y encima es endemoniadamente rápido. Para completar la comparación en mi ordenador, voy a reproducir también la función hecha en Cython:</p>
    </div>
  </div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">load_ext</span> cython
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%%</span><span class="n">cython</span> <span class="o">--</span><span class="n">name</span> <span class="n">probandocython9</span>
<span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">from</span> <span class="nn">cpython</span> <span class="k">cimport</span> <span class="n">array</span> <span class="k">as</span> <span class="n">c_array</span>
<span class="k">from</span> <span class="nn">array</span> <span class="k">import</span> <span class="n">array</span>
<span class="k">cimport</span> <span class="nn">cython</span>

<span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> 
<span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="k">cpdef</span> <span class="kt">tuple</span> <span class="nf">busca_min_cython9</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,:]</span> <span class="n">malla</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">c_array</span>.<span class="kt">array</span> <span class="nf">minimosx</span><span class="p">,</span> <span class="nf">minimosy</span>
    <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span>
    <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ii</span> <span class="o">=</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span>
    <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">jj</span> <span class="o">=</span> <span class="n">malla</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf"></span><span class="p">]</span><span class="o">-</span><span class="mf">1</span>
    <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">start</span> <span class="o">=</span> <span class="mf">1</span>
    <span class="c">#cdef float [:, :] malla_view = malla</span>
    <span class="n">minimosx</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#039;L&#039;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">minimosy</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#039;L&#039;</span><span class="p">,</span> <span class="p">[])</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">ii</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">jj</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">malla</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]):</span>
                <span class="n">minimosx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">minimosy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimosx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimosy</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="o">%</span><span class="k">timeit</span> busca_min_cython9(data)
</pre>
        </div>
      </div>
    </div>
  </div>

<p><div>
    <div>
      <div>
        <div>
        </div></p>
<div class="highlight"><pre><span></span>    &lt;div&gt;
      &lt;pre&gt;10 loops, best of 3: 151 ms per loop
</pre></div>


<p></pre>
        </div>
      </div>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Por tanto, vemos que <strong>la versión con numba es el doble de rápida que la versión con Cython</strong>. Sobre gustos no hay nada escrito: yo por ejemplo valoro no «salirme» de Python usando numba mientras que a otro puede no importarle incluir especificaciones de tipos como en Cython. Los números, eso sí, son los números 🙂</p>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="M&#225;s-casos-de-&#233;xito">
        M&#225;s casos de &#233;xito<a class="anchor-link" href="#M&#225;s-casos-de-&#233;xito">&#182;</a>
      </h2>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h3 id="La-atm&#243;sfera-est&#225;ndar">
        La atm&#243;sfera est&#225;ndar<a class="anchor-link" href="#La-atm&#243;sfera-est&#225;ndar">&#182;</a>
      </h3></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    El <span class="nt">&lt;strong&gt;</span>cálculo de propiedades termodinámicas de la atmósfera estándar<span class="nt">&lt;/strong&gt;</span> es un problema clásico que todo aeronáutico ha afrontado alguna vez muy al principio de su carrera formativa. La teoría es simple: imponemos una ley de variación de la temperatura con la altura $T = T(h)$, la presión se obtiene por consideraciones hidrostáticas $p = p(T)$ y la densidad por la ecuación de los gases ideales $\rho = \rho(p, T)$. La particularidad de la atmósfera estándar es que imponemos que la variación de la temperatura con la altura es una función simplificada <span class="nt">&lt;em&gt;</span>y definida a trozos<span class="nt">&lt;/em&gt;</span>, así que calcular temperatura, presión y densidad dada una altura se parece mucho a hacer esto:
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="k">if</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mf">11000.0</span><span class="p">:</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">h</span>
    <span class="n">p</span> <span class="o">=</span> <span class="o">...</span>  <span class="c"># Algo que depende de T</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">R_a</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
<span class="k">elif</span> <span class="mf">11000.0</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mf">20000.0</span><span class="p">:</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">T1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">R_a</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
<span class="k">elif</span> <span class="mf">20000.0</span> <span class="o">&lt;=</span> <span class="n">h</span> <span class="o">&lt;=</span> <span class="mf">32000.0</span><span class="p">:</span>
    <span class="o">...</span>
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      El problema viene cuando se quiere <strong>vectorizar</strong> esta función y permitir que <code>h</code> pueda ser un array de alturas. Esto es muy conveniente cuando queremos pintar alguna propiedad con matplotlib, por ejemplo.<br /> Se intuye que hay dos formas de hacer esto: utilizando funciones de NumPy o iterando por cada elemento del array. La primera solución se hace farragosa, y la segunda, gracias a la proverbial lentitud de Python, es extremadamente lenta. Mi amigo <a href="http://twitter.com/Alex__S12">Álex</a> y yo llevamos pensando sobre este problema <em>años</em>, y nunca hemos llegado a una solución satisfactoria (incluso <a href="https://github.com/numpy/numpy/pull/331">encontramos algunos bugs en <code>numpy.piecewise</code></a> por el camino). Este año decidimos cerrar este asunto definitivamente así que con <a href="https://github.com/AeroPython">el equipo AeroPython</a> exploramos varias implementaciones distintas. Hasta que por fin lo conseguimos: <strong>usamos numba para acelerar los bucles</strong>.<br /> <img src="https://cloud.githubusercontent.com/assets/316517/6236738/63dabc48-b6ed-11e4-822f-2c36c0d96f76.png" alt="numba gana a C++" /><br /> Como podéis leer <a href="https://github.com/AeroPython/aeropy/issues/4#issuecomment-74748524">en la discusión original</a>, la función de la primera columna está escrita en C++. ¿Impresionado? 😉</p>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h3 id="Soluci&#243;n-de-Navier-de-una-placa-plana">
        Soluci&#243;n de Navier de una placa plana<a class="anchor-link" href="#Soluci&#243;n-de-Navier-de-una-placa-plana">&#182;</a>
      </h3></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    Para mi proyecto fin de carrera me encontré con la necesidad de calcular la deflexión de una placa rectangular, simplemente apoyada en sus cuatro bordes (es decir, los bordes pueden girar: no están empotrados) sometida a una carga transversal. Este problema tiene solución analítica conocida desde hace tiempo, hallada por Navier:<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> $\displaystyle w(x,y) = \sum_{m=1}^\infty \sum_{n=1}^\infty \frac{a_{mn}}{\pi^4 D}\,\left(\frac{m^2}{a^2}+\frac{n^2}{b^2}\right)^{-2}\,\sin\frac{m \pi x}{a}\sin\frac{n \pi y}{b}$
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    siendo $a_{mn}$ los coeficientes de Fourier de la carga aplicada. Como veis, para cada punto $(x, y)$ hay que hacer una doble suma en serie; si encima queremos evaluar esto en un <span class="nt">&lt;code&gt;</span>meshgrid<span class="nt">&lt;/code&gt;</span>, necesitamos <span class="nt">&lt;strong&gt;</span>un cuádruple bucle<span class="nt">&lt;/strong&gt;</span>. Ya se anticipa que por muy hábiles que estemos, a Python le va a costar.<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> La clave estuvo, una vez más, en usar numba para optimizar los bucles. En GitHub tenéis <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://gist.github.com/Juanlu001/cf19b1c16caf618860fb&quot;</span><span class="nt">&gt;</span>el código completo<span class="nt">&lt;/a&gt;</span>, pero la parte importante es esta:
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
<div>
  <div>
    <div>
      <div>
        <div class=" highlight hl-ipython3">
          <pre><span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">a_mn_point</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nn</span><span class="p">):</span>
    <span class="sd">"""Navier series coefficient for concentrated load.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">P</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">mm</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">nn</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>


<span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plate_displacement</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">max_m</span><span class="p">,</span> <span class="n">max_n</span><span class="p">):</span>
    <span class="n">max_i</span><span class="p">,</span> <span class="n">max_j</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_m</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_j</span><span class="p">):</span>
                    <span class="n">a_mn</span> <span class="o">=</span> <span class="n">a_mn_point</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>
                    <span class="n">ww</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">a_mn</span> <span class="o">/</span> <span class="p">(</span><span class="n">mm</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">nn</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                                   <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">mm</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
                                   <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">nn</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">yy</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
                                   <span class="o">/</span> <span class="p">(</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">D</span><span class="p">))</span> 
</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
  </div>

<p><div>
    <div>
      <img src="https://camo.githubusercontent.com/9e60d6258ba6e0270338a8afe310db410baacfd0/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f4235696459656843454145533470452e706e67" alt="Solución de una placa plana" /></p>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      Podéis comprobar vosotros mismos que las diferencias de rendimiento en este caso son brutales. <em>Y solo hemos añadido una línea a cada función</em>.</p>
    </div>
  </div>
</div></p>
<div>
  <div>
  </div>

<p><div>
    <div>
      <h2 id="Conclusiones">
        Conclusiones<a class="anchor-link" href="#Conclusiones">&#182;</a>
      </h2></p>
<div class="highlight"><pre><span></span>  <span class="nt">&lt;p&gt;</span>
    numba aún no es una herramienta estable, pero está rápidamente alcanzando un grado de madurez suficiente para optimizar código orientado a operar con arrays. Gracias a conda es trivial de instalar y los resultados respecto a soluciones más maduras como Cython son aplastantes, tanto en velocidad de ejecución como en la complejidad del código resultante.<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> De momento yo me quedo con numba, ¿y tú? 😉
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p></div>
</div></p>
        </div>

        <div class="meta">
            <div class="tags">
                    <a href="http://pybonacci.github.io/tag/conda.html" class="tag">conda</a>
                    <a href="http://pybonacci.github.io/tag/numba.html" class="tag">numba</a>
                    <a href="http://pybonacci.github.io/tag/python.html" class="tag">python</a>
                    <a href="http://pybonacci.github.io/tag/python-3.html" class="tag">python 3</a>
                    <a href="http://pybonacci.github.io/tag/rendimiento.html" class="tag">rendimiento</a>
            </div>
        </div>


    </article>
<div id="commento"></div>
</div>

<style type="text/css">
{
    max-width: 700px;
}

.text_cell .prompt {
    display: none;
}

div.cell {
    padding: 0;
}

div.text_cell_render {
    padding: 0;
}

div.prompt {
    font-size: 13px;
}

div.input_prompt {
    padding: .7em 0.2em;
}

div.output_prompt {
    padding: .4em .2em;
}

div.input_area {
    margin: .2em 0.4em;
    max-width: 580px;
}

table.dataframe {
    font-family: Arial, sans-serif;
    font-size: 13px;
    line-height: 20px;
}

table.dataframe th, td {
    padding: 4px;
    text-align: left;
}

pre code {
    background-color: inherit;
}</style>

        </div>

        <footer class="disclaimer">
          <div class="container-fluid">
            <p>
              © 2012-2017 Pybonacci, licencia <a href="https://github.com/Pybonacci/pybonacci.github.io/blob/sources/LICENSE.md"> CC BY-SA 4.0 + MIT</a>
              salvo otra indicación.
              <p>Contenido generado con <a href= "http://docs.getpelican.com/">Pelican</a>.</p>
            </p>
          </div>
        </footer>

    </body>
</html>